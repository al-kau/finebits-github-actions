################################################################################
#                                                                              #
#   Copyright 2025 Finebits (https://finebits.com)                             #
#                                                                              #
#   Licensed under the Apache License, Version 2.0 (the "License");            #
#   you may not use this file except in compliance with the License.           #
#   You may obtain a copy of the License at                                    #
#                                                                              #
#       http://www.apache.org/licenses/LICENSE-2.0                             #
#                                                                              #
#   Unless required by applicable law or agreed to in writing, software        #
#   distributed under the License is distributed on an "AS IS" BASIS,          #
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.   #
#   See the License for the specific language governing permissions and        #
#   limitations under the License.                                             #
#                                                                              #
################################################################################

---

name: Setup the Uno Platform prerequisites

description: |
  
inputs:
  uno-check-manifest:
    type: string
    description: Specific manifest URL of the 'uno-check' tool
    default: ''
    required: false

  uno-check-version:
    type: string
    description: Specific version of the 'uno-check' tool
    default: ''
    required: false

  default-dotnet-version:
    type: string
    default: 8.x
    required: false

  default-dotnet-root:
    type: string
    default: ${{ github.workspace }}/.dotnet
    required: false

runs:
  using: "composite"

  steps:
    - name: Setup dotnet
      uses: actions/setup-dotnet@67a3573c9a986a3f9c594539f4ab511d57bb3ce9 # v4.3.1
      with:
        dotnet-version: ${{ inputs.default-dotnet-version }}
      env:
        DOTNET_INSTALL_DIR: ${{ inputs.default-dotnet-root }}

    - id: read-manifest
      if: ${{ runner.os == 'Linux' }}
      uses: al-kau/finebits-github-actions/devhub/uno-platform/read-manifest@preview
      with:
        uno-check-manifest: ${{ inputs.uno-check-manifest }}
        uno-check-version: ${{ inputs.uno-check-version }}

    - uses: actions/setup-java@c5195efecf7bdfc987ee8bae7a71cb8b11521c00 # v4.7.1
      if: ${{ runner.os == 'Linux' }}
      with:
        distribution: 'microsoft'
        java-version: ${{ fromJson( steps.read-manifest.outputs.content ).check.openjdk.version }}
